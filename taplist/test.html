<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="author" content="Andrew Clow, from original code by Phil Murray">
    <meta name="robots" content="noindex, nofollow" />

    <title>RCC Tap List</title>

    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap" rel="stylesheet">
    <link href="test.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sprintf/1.1.2/sprintf.min.js"></script>
  </head>

  <body onload="startTime()">

    <div class="container">

      <div class="box header">
        <div class="logo"></div>
        <div class="title">
          <h1 id="title">Work in progress...</h1>
        </div>
        <div id="clock" class="clock"></div>
      </div>

      <div id="taps" class="box taplist">

        <div class="labelHeader">
          <div class="labels">
            <div class=""></div>
            <div class="abv">ABV</div>
            <div class="half">Half</div>
            <div class="handle">Handle</div>
            <div class="take-home">1.25L</div>
          </div>

          <div class="labels">
            <div class=""></div>
            <div class="abv">ABV</div>
            <div class="half">Half</div>
            <div class="handle">Handle</div>
            <div class="take-home">1.25L</div>
          </div>
        </div>

        <div class="tapContents">
          <div class="beerDetails">
            <div class="badge">
              <img src="https://untappd.akamaized.net/site/beer_logos/beer-2567061_41cf1_sm.jpeg">
            </div>
              <div class="name">Tax Evasion<span>- Brewaucracy</span></div>
              <div class="beerStyle">English Bitter</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge">
              <img src="default_tap.svg">
            </div>
              <div class="name">Monteith's Black<span>- Monteith's Brewing Co.</span></div>
              <div class="beerStyle">Lager - Dark</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge nis">
              <img src="default_tap.svg">
            </div>
              <div class="name">Pioneer Porter<span>- McLeod's</span></div>
              <div class="beerStyle">Porter</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge">
              <img src="default_tap.svg">
            </div>
              <div class="name">Panic Buy (Motueka)<span>- Brewaucracy</span></div>
              <div class="beerStyle">NZ Pale Ale</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge special">
              <img src="default_tap.svg">
            </div>
              <div class="name">Waikato Draught<span>- Lion Nathan</span></div>
              <div class="beerStyle">Lager - Red</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge">
              <img src="default_tap.svg">
            </div>
              <div class="name">Baltic Porter<span>- Garage Project</span></div>
              <div class="beerStyle">Porter - Baltic</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>

          <div class="beerDetails">
            <div class="badge special">
              <img src="https://untappd.akamaized.net/site/beer_logos/beer-2567061_41cf1_sm.jpeg">
            </div>
              <div class="name">Rock Solid<span>- Baylands Brewery</span></div>
              <div class="beerStyle">NZ Pilsner</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge">
              <img src="default_tap.svg">
            </div>
              <div class="name">No.1 Kolsch Bier<span>- Hallertau</span></div>
              <div class="beerStyle">Kolsch</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge nis">
              <img src="default_tap.svg">
            </div>
              <div class="name">Rail Slider<span>- Baylands Brewery</span></div>
              <div class="beerStyle">Pale Ale</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge nis">
              <img src="default_tap.svg">
            </div>
              <div class="name">Pointsman Lager<span>- Shunters Yard</span></div>
              <div class="beerStyle">Lager - Helles</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge">
              <img src="default_tap.svg">
            </div>
              <div class="name">Paradise Pale Ale<span>- McLeod's</span></div>
              <div class="beerStyle">Pale Ale</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>
          <div class="beerDetails">
            <div class="badge">
              <img src="default_tap.svg">
            </div>
              <div class="name">Hop Zombie<span>- Epic</span></div>
              <div class="beerStyle">Double IPA</div>
              <div class="values abv">4%</div>
              <div class="values half">$4.50</div>
              <div class="values handle">$7.00</div>
              <div class="values take-home">$14.00</div>
          </div>

        </div>
      </div>

      <div class="box footer"><marquee id="footer">Scrolling message here...</marquee></div>
    </div>

    <script type="text/javascript">
      var sheetUrl = "https://docs.google.com/spreadsheets/d/1Zr9JT4QnnwZU9PuBM0S4lJQzfayxDLxEh1CoPzV4194/edit?usp=sharing"
      var tabletop;

      function init() {
        tabletop = Tabletop.init( {
          key: sheetUrl,
          callback: displayTaps,
          simpleSheet: false
        })
      }

      function headerFooter(data, tabletop) {
        var footerMessage = '';
        var sheet = data['Messages'];
        var message = sheet.elements[0];
        if( message['Title'] == '' ) { // No title defined
          message['Title'] = 'Tap List';
        }
        document.getElementById("title").innerHTML = message['Title'];

        for (var i = 0; i < sheet.elements.length; i++) {
          message = sheet.elements[i]
          if(footerMessage == '') {
            footerMessage = '<span>'+message['Footer']+'</span>';
          }else{
            footerMessage = footerMessage + '<span>'+message['Footer']+'</span>';
          }
        }
        document.getElementById("footer").innerHTML = footerMessage;
      }

      function displayTaps(data, tabletop) {
        var beerList = { beers: [] };
        var sheet = data['Taplist'];
        for(var idx = 0; idx < 12; idx++ ) {
          var tap = sheet.elements[idx];

          if(tap['Name'] == '') { // Tap with no beer assigned
            tap['Name'] = '\xa0'; // Non-Breaking Space, ensures row heights match up
          }

          if(tap['Brewery'] != '') {
            tap['Brewery'] = ' - ' + tap['Brewery'];
          }

          let field = 'ABV'
          let abv = parseFloat(tap[field])
          if(!isNaN(abv)) {
            tap[field] = sprintf("%0.1f", abv) + '%';
          } else if(tap[field] == '') {
            tap[field] = '-';
          }

          field = 'half-price'
          let price = parseFloat(tap[field])
          if(!isNaN(price)) {
            tap[field] = "$" + sprintf("%0.2f", price);
          } else if(tap[field] == '') {
            tap[field] = '-';
          }

          field = 'handle-price'
          price = parseFloat(tap[field])
          if(!isNaN(price)) {
            tap[field] = "$" + sprintf("%0.2f", price);
          } else if(tap[field] == '') {
            tap[field] = '-';
          }

          field = 'rigger'
          let takehome = parseFloat(tap[field])
          if(!isNaN(takehome)) {
            tap[field] = "$" + sprintf("%0.2f", takehome);
          } else if(tap[field] == '') {
            tap[field] = '-';
          }

          beerList.beers.push(tap);
        }

        var templateHtml = document.getElementById('tap-template').innerHTML;

        var renderedList  = Mustache.render(templateHtml, beerList);

        document.getElementById("taps").innerHTML = renderedList;
        headerFooter(data,tabletop);
      }

      function startTime(){
        var time = new Date()
        var hr = time.getHours()
        var min = time.getMinutes()
        var sec = time.getSeconds()
        var ampm = " pm "
        if (hr < 12){
          ampm = " am "
        }
        if (hr > 12){
          hr -= 12
        }
        if (hr < 10){
          hr = " " + hr
        }
        if (min < 10){
          min = "0" + min
        }
        if (sec < 10){
          sec = "0" + sec
        }
        document.getElementById('clock').innerHTML = hr + ":" + min + ampm
        setTimeout("startTime()", 1000)
      }

      window.addEventListener("DOMContentLoaded", init);
      // Reload the page every 60 seconds (60000 milliseconds)
      window.setInterval(function() { tabletop.fetch() }, 60000)
    </script>


    <script id="tap-template" type="text/html">
      <div class="labelHeader">
        <div class="labels">
          <div class=""></div>
          <div class="abv">ABV</div>
          <div class="half">Half</div>
          <div class="handle">Handle</div>
          <div class="take-home">1.25L</div>
        </div>
        <div class="labels">
          <div class=""></div>
          <div class="abv">ABV</div>
          <div class="half">Half</div>
          <div class="handle">Handle</div>
          <div class="take-home">1.25L</div>
        </div>
      </div>
      <div class="tapContents">
        {{#beers}}
        <div class="beerDetails {{Class}}">
          <div class="badge">
            <img src="{{Badge}}">
          </div>
          <!-- <div class="name">{{Tap}}. {{Name}}<span>{{Brewery}}</span></div> -->
          <div class="name">{{Name}}<span>{{Brewery}}</span></div>
          <div class="beerStyle">{{Style}}</div>
          <div class="values abv">{{ABV}}</div>
          <div class="values half">{{half-price}}</div>
          <div class="values handle">{{handle-price}}</div>
          <div class="values take-home">{{rigger}}</div>
        </div>
        {{/beers}}
      </div>
    </script>

  </body>
</html>